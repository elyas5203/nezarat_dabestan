/*!
	By André Rinas, www.andrerinas.de
	Available for use under the MIT License
	1.12.1
*/
(function($,window,document,undefined){'use strict';var pluginName='simpleLightbox',defaults={sourceAttr:'href',overlay:true,spinner:true,nav:true,navText:['&lsaquo;','&rsaquo;'],captions:true,captionDelay:0,captionSelector:'img',captionType:'attr',captionsData:'title',captionPosition:'bottom',captionClass:'',close:true,closeText:'×',swipeClose:true,showCounter:true,fileExt:'png|jpg|jpeg|gif',animationSpeed:250,animationSlide:true,preloading:true,enableKeyboard:true,loop:true,rel:false,docClose:true,swipeTolerance:50,className:'simple-lightbox',widthRatio:0.8,heightRatio:0.9,scaleImageToRatio:false,disableRightClick:false,disableScroll:true,alertError:true,alertErrorMessage:'Image not found, next image will be loaded',additionalHtml:false,history:true,throttleInterval:0};$.fn.simpleLightbox=function(options){return this.each(function(){var a=this;if($(this).data('simpleLightbox'))return;var $items=$(this).find('a'),settings=$.extend({},defaults,options),transPrefix=function(){var s=document.body||document.documentElement,s=s.style,prefix=['-webkit-','-moz-','-o-','-ms-',''],i;for(i in prefix)if(typeof s[prefix[i]+'transition']=='string')return prefix[i];return''}(),opened=false,loaded=false,getHash=function(){return window.location.hash.substring(1)},initialHash=getHash(),curImg,curGallery,element,selector,dom=$('<div>').addClass('sl-overlay'),spinner=$('<div class="sl-spinner">').addClass('sl-spinner'),elem=$('<div>').addClass('sl-wrapper').addClass(settings.className),closeBtn=$('<button>').addClass('sl-close').html(settings.closeText),prevBtn=$('<button>').addClass('sl-prev').html(settings.navText[0]),nextBtn=$('<button>').addClass('sl-next').html(settings.navText[1]),counter=$('<div class="sl-counter">').addClass('sl-counter'),navigation=$('<div>').addClass('sl-navigation').append(prevBtn,nextBtn),caption=$('<div>').addClass('sl-caption').addClass(settings.captionClass).css({'position':settings.captionPosition}),image=$('<div>').addClass('sl-image'),wrapper=$('<div>').addClass('sl-wrapper'),isValidLink=function(element){return!settings.fileExt||'|'==settings.fileExt||element.attr(settings.sourceAttr).match(new RegExp('\\.('+settings.fileExt+')$','i'))},setup=function(){if($items.length){elem.append(closeBtn).append(counter).append(navigation);dom.append(spinner);$(a).on('click.'+pluginName,'a',function(e){if(isValidLink($(this))){e.preventDefault();if(opened)return false;element=$(this);curGallery=$items;openImage(element)}});if(settings.docClose){dom.on('click.'+pluginName,function(e){if(opened&&e.target==e.currentTarget){close()}})}if(settings.disableRightClick){$(document).on('contextmenu',".sl-image img",function(e){return false})}if(settings.enableKeyboard){$(document).on('keyup.'+pluginName,function(e){e.preventDefault();if(opened){var key=e.keyCode;if(key==27){close()}if(key==37||e.keyCode==39){$(document).off('keyup.simplelightbox');setTimeout(function(){slide(e.keyCode==39?1:-1)},settings.animationSpeed);$(document).on('keyup.simplelightbox',function(e){if(opened){e.preventDefault();var key=e.keyCode;if(key==27){close()}if(key==37||e.keyCode==39){slide(e.keyCode==39?1:-1)}}})}}})}if(settings.history){var th=setInterval(function(){if(getHash()!=initialHash){if(opened){close()}}else{if(!opened){var el=$items.filter('[rel="'+getHash()+'"]');if(el.length>0){openImage(el)}}}},50)}},openImage=function(elem){if(elem){element=elem;var g=$items.index(element);curImg=$('<img>').on('error',function(e){curImg.remove();if(settings.alertError){alert(settings.alertErrorMessage)}slide(1)});if(settings.rel&&settings.rel!==false){var r=$items.filter('[rel="'+element.attr('rel')+'"]');curGallery=r}else{curGallery=$items}if(!opened){setup()}dom.appendTo('body');elem.appendTo('body');if(settings.overlay){dom.fadeIn('fast')}spinner.appendTo(elem);opened=true;selector=curGallery.index(element);curImg.attr('src',element.attr(settings.sourceAttr));$(document).on('click.simplelightbox',function(e){if(!$(e.target).is(element.get(0))&&!$(e.target).is($('a img').get(0))&&opened){close()}});elem.fadeIn('fast').append(image);placeImage();if(settings.preloading){preload()}}},placeImage=function(direction){if(!opened)return;direction=typeof direction==='undefined'?0:direction;var wWidth=$(window).width()*settings.widthRatio,wHeight=$(window).height()*settings.heightRatio,captionHeight=0;if(settings.captions){caption.html(eval('element.'+settings.captionType+'(settings.captionsData)'));caption.appendTo(elem);captionHeight=caption.outerHeight();caption.css({top:wHeight-captionHeight})}var setWidth=function(){spinner.show();curImg.css({width:'auto',height:'auto'});var nw=curImg.width(),nh=curImg.height();if(nw>wWidth||nh>wHeight){var ratio=nw/nh>wWidth/wHeight?nw/wWidth:nh/wHeight;nw/=ratio;nh/=ratio}curImg.css({width:nw,height:nh,top:($(window).height()-nh)/2,left:($(window).width()-nw)/2-$(window).scrollLeft()});spinner.hide();if(settings.animationSlide){if(direction==1){curImg.addClass('sl-slide-to-right')}else if(direction==-1){curImg.addClass('sl-slide-to-left')}setTimeout(function(){curImg.removeClass('sl-slide-to-left').removeClass('sl-slide-to-right')},settings.animationSpeed)}};image.html('').append(curImg);setWidth();if(settings.history){window.location.hash=element.attr('rel')}},close=function(){if(!opened)return;var hash=getHash();if(hash){window.location.hash=''}curImg.remove();caption.remove();navigation.remove();counter.remove();closeBtn.remove();spinner.remove();dom.fadeOut('fast');elem.fadeOut('fast',function(){elem.remove();dom.remove();$(document).off('click.simplelightbox');opened=false})},slide=function(direction){if(!opened)return;var newElem=curGallery.eq((selector+direction)%curGallery.length);if(newElem.length==0&&settings.loop==false)return;selector=(selector+direction)%curGallery.length;element=newElem;caption.fadeOut(settings.animationSpeed);if(settings.animationSlide){var css={opacity:0};if(direction==1){css.left='-100%'}else{css.left='100%'}curImg.animate(css,settings.animationSpeed,function(){setTimeout(function(){placeImage(direction)},settings.animationSpeed)})}else{curImg.fadeOut(settings.animationSpeed,function(){placeImage(direction)})}},preload=function(){var next=curGallery.eq((selector+1)%curGallery.length),prev=curGallery.eq((selector-1)%curGallery.length);$('<img />').attr('src',next.attr(settings.sourceAttr));$('<img />').attr('src',prev.attr(settings.sourceAttr))};setup()})}})(jQuery,window,document);
